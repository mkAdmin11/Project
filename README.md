# Project

## СПИСОК PLAYBOOK:

1. start.yml
2. openvpn.yml
3. bind9.yml
4. postgreslq.yml
5. web.yml
6. certbot.yml
7. www.yml
8. mail.yml
9. pgadmin.yml
10. elastic.yml
11. logs.yml
12. zabbix.yml
13. grafana.yml

### Start
*Все сервера*
<br/> Первоначальная настройка всех хостов:
+ Установка некоторых нужных в дальнейшем пакетов и обновление установленных.
+ Настройка шары - в дальнейшем будет использоваться для копирования данных. Задачи в cron для взаимной синхронизации.
+ Создание шаблонов скриптов для работы через cron - для поднятия сервисов с задержкой после перезагрузки в правильном порядке.
<br/> Присутствовали дополнительные настроки, которые были вырезаны, такие как настрока zsh, т.к. не относятся к проекту. 

### OpenVPN
*Сервер 1*
<br/>
+ Настраивается и поднимается OpenVPN сервер.
*Сервер 2 и 3*
+ Настраивается 2 клиента, подключаются к серверу с автозагрузкой.
Предполагается что инфраструктура выдачи ключей имеется и готовы пары ключей для всех серверов, а также ca и dh. Использовалась easy-rsa.

### Bind9
*Сервер 2*
<br/>
* Устанавливается Bind9 на первый сервер и все сервера настраиваются на резолв через него. В Bind настрона defaul зона, а также зоны local и зона домена.

### PostgreSQL
Устанавливается PostgreSQL на сервер базы данных. Изначально по ролям из дирректории old создавались пользователи, базы, заливались схемы и данные для сервисов: WordPress, Zabbix, Rouncube, база Demo для pgAdmin и учетная запись для мониторинга состояния базы. В дальнейшем восстанавливался весь дамп кластера базы, т.к. накопились данные в основном от WordPress и Zabbix. При таком исполнении переносятся все базы, данные, схемы, а также пользователи со всеми правами. Остается только выдать права на сетевое подключение для пользователей.

### WEB
Установка nginx, Apache2, PHP и потребующиея в дальнейшем библиотеки. Первоначальная настройка: nginx - работает как прокси, Apache2 - показывает стандвртный индекс nginx. Веб сервер подготовлен для получения SSL сертификатов.

### Certbot
Установка Certbot и получение сертификатов через webroot. Настройка nginx:
+ Домен второго уровня проксирует запросы на Apache2, дополнительно проксируются запросы к сервисам которые появятся позже: Grafana на первом сервере и Kibana на третьсяем сервере. 
+ Домен третьего уровя forcustomer проксирует запросы на Apache2. 

### WWW
*Сервер 2.*
<br/>
Использется шара - копируется код для обработки Apache2:
+ Wordress - основа домена [второго уровня](https://admin11.tk/). За основу взята актуальная на момент создания версия 5.9.3. Для использования PostgreSQL плагин [pg4wp](https://github.com/kevinoid/postgresql-for-wordpress). Также установлена тема Basic от [WP Puzzle](https://admin11.tk/wp-admin/themes.php?theme=basic) со слегка измененными стилями CSS и плагин [Contact Form 7](https://contactform7.com/).
+ Страница картинка для домена [третьего уровня](https://forcustomer.admin11.tk/). И форма обратной связи, за основы взят [этот](https://github.com/itchief/feedback-form) проект с GitHub, также внесены небольшие изменения в PHP код и CSS стили, форма упакована в страницу картинку.
+ Настроенный Roundcube версии 1.5.2 для [почтового сервера](https://admin11.tk/app/mail/).
<br/>
Настройка Apache2. Один конфиг, два VirtualHost для домена первого и второго уровня.
+ Домен вервого уровня имеет root в дирректорию Wordpress, а также алиасы в директории Zabbix, mail и pgAdmin4
+ Домен третьего уровня имеет root в корень дирректории forcustomer.





