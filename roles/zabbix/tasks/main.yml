---

- name: Add Zabbix repository
  apt:
    deb: "https://repo.zabbix.com/zabbix/5.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_5.0-1+focal_all.deb"

- name: apt update
  apt:
    update_cache: yes

- name: Up Zabbix server
  import_tasks: server.yml
  when: ansible_hostname == 'mk-server1'

- name: Install agents
  apt:
    name: zabbix-agent
    state: latest

- name: Start agent
  systemd:
    name: zabbix-agent.service
    enabled: yes
    state: started

- name: Config agent
  template:
    src: zabbix_agentd.conf
    dest: "/etc/zabbix/zabbix_agentd.conf"
    mode: 0644
  notify:
    handler_restart_agent

- name: PHP frontend
  import_tasks: php.yml
  when: ansible_hostname == 'mk-server2'
