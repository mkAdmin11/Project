---

- name: Check list
  stat:
    path: /etc/apt/sources.list.d/elastic-7.x.list
  register: list

- name: Add repo
  template:
    src: elastic-7.x.list
    dest: /etc/apt/sources.list.d/elastic-7.x.list
    mode: 0644
  when: list.stat.isreg is not defined

- name: apt update
  apt:
    update_cache: yes

- name: Install Logstash 
  import_tasks: logstash.yml
  when: ansible_hostname == 'mk-server3'

- name: Install Filebeat
  import_tasks: filebeat.yml
  when: ansible_hostname != 'mk-server3'

- name: Change number of replicas
  shell: "curl -u {{ elk.users.elastic.name }}:{{ elk.users.elastic.pass }} -XPUT \"elk.local:9200/$idx/_settings\" -H 'Content-Type: application/json' -d '{ \"index\": { \"number_of_replicas\": 0 } }'"
  when: ansible_hostname == 'mk-server3'
