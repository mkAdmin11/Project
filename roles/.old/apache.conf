<VirtualHost {{ ansible_facts.tun0.ipv4.address }}:8080>

  ServerName {{ domain.second }}{{ domain.top }}
  ServerAlias web.local

  <IfModule remoteip_module>
    RemoteIPHeader X-Forwarded-For
    RemoteIPTrustedProxy {{ vpn.gate }}/{{ vpn.prefix }}
  </IfModule>

####### WordPress #######

  ServerRoot /var/www/wordpress
  DocumentRoot /var/www/wordpress

  <Directory /var/www/wordpress>
    Options FollowSymLinks
    AllowOverride All
    DirectoryIndex index.php
    Order allow,deny
    Allow from all
  </Directory>

  <Directory /var/www/wordpress/wp-content>
    Options FollowSymLinks
    Order allow,deny
    Allow from all
  </Directory>

####### RoundCube #######

  <IfModule mod_alias.c>
    Alias /app/mail /var/www/mail
  </IfModule>

####### pdAdmin #######

  WSGIDaemonProcess pgadmin processes=1 threads=25 python-home=/usr/pgadmin4/venv
  WSGIScriptAlias /app/pgadmin4 /usr/pgadmin4/web/pgAdmin4.wsgi

  <Directory /usr/pgadmin4/web/>
    WSGIProcessGroup pgadmin
    WSGIApplicationGroup %{GLOBAL}
    Require all granted
  </Directory>

####### Zabbix #######

  <IfModule mod_alias.c>
    Alias /app/zabbix /usr/share/zabbix
  </IfModule>

  <Directory "/usr/share/zabbix">
    Options FollowSymLinks
    AllowOverride None
    Order allow,deny
    Allow from all

    <IfModule mod_php5.c>
      php_value max_execution_time 300
      php_value memory_limit 128M
      php_value post_max_size 16M
      php_value upload_max_filesize 2M
      php_value max_input_time 300
      php_value max_input_vars 10000
      php_value always_populate_raw_post_data -1
      php_value date.timezone Europe/Moscow
    </IfModule>

    <IfModule mod_php7.c>
      php_value max_execution_time 300
      php_value memory_limit 128M
      php_value post_max_size 16M
      php_value upload_max_filesize 2M
      php_value max_input_time 300
      php_value max_input_vars 10000
      php_value always_populate_raw_post_data -1
      php_value date.timezone Europe/Moscow
    </IfModule>
  </Directory>

  <Directory "/usr/share/zabbix/conf">
    Order deny,allow
    Deny from all
    <files *.php>
      Order deny,allow
      Deny from all
    </files>
  </Directory>

  <Directory "/usr/share/zabbix/app">
    Order deny,allow
    Deny from all
    <files *.php>
      Order deny,allow
      Deny from all
    </files>
  </Directory>

  <Directory "/usr/share/zabbix/include">
    Order deny,allow
    Deny from all
    <files *.php>
      Order deny,allow
      Deny from all
    </files>
  </Directory>

  <Directory "/usr/share/zabbix/local">
    Order deny,allow
    Deny from all
    <files *.php>
      Order deny,allow
      Deny from all
    </files>
  </Directory>

  <Directory "/usr/share/zabbix/vendor">
    Order deny,allow
    Deny from all
    <files *.php>
      Order deny,allow
      Deny from all
    </files>
  </Directory>

</VirtualHost>
